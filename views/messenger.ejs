<%- include('./head'); %>
    
    <div style="display: none;">
        <p id="id_user">
            <%= id %>
        </p>
        <p id="id_chat">
            <% try { %> 
            <%= chats[chatIndex].id %>
            <% } catch { %>
                -1
                <% } %>  
        </p>
    </div>


        
        <div class="messenger">
            <%- include('./navbar', {auth: true}); %>
            <div class="messenger_container">

                <div class="messenger_container_chats">

                    <div class="messenger_container_chats_header">Чаты</div> 

            
                
                <div class="messenger_container_chats_list">
                    

                    <% for(let i=0;i < chats.length; i++) {%>
                        <a href="/messenger/<%= chats[i].id%>" class="messenger_container_chats_list_chat"
                            id="<%= chats[i].id%>">
                            <div class="messenger_container_chats_list_chat_container">
                                <div class="messenger_container_chats_list_chat_container_text">
                                    <% if(chats[i]) { %>
                                        <%= chats[i].name %>
                                            <% } %>
                                </div>
                            </div>
                        </a>
                        <% } %>
                </div>
            </div>

            <% if (isChat) { %>
                    <div class ="flex flex-col overflow-hidden mx-8 my-8 rounded-2xl w-full grow shadow-2xl">
                        
                        <div class="py-4 px-4 text-lg border-0 bg-gray-300 italic font-bold mb-2 shadow">
                            <%= chats[chatIndex].name %>
                        </div>

                            <div class="flex flex-col overflow-auto w-full h-full" id="messages_container">
                            <% for(let i = 0; i < messages.length; i++) { %>
                                <% if(!messages[i].service) { %> 
                                    <% if(!messages[i].deleted_user) { %>
                                            <div id="<%= messages[i].id_msg %>" class="flex flex-row items-center">
                                                <% if(messages[i].user_id == id) { %>
                                                    <div class="flex-1"></div>
                                                    <div class="bg-violet-600 px-3 py-1 mb-1 mx-2 rounded-xl shadow-lg">
                                                        <%= messages[i].text %>
                                                    </div>
                                                <% } %> 
                                                <% if(messages[i].user_id != id) { %>
                                                    <div class="bg-violet-400 px-3 py-1 mb-1 mx-2 rounded-xl shadow-lg">
                                                        <%= messages[i].text %>
                                                    </div>
                                                    <div class="flex-1"></div>
                                                <% } %> 
                                            </div>
                                    <% } %>
                                <% } else { %>
                                    <div id="<%= messages[i].id_msg %>" class="flex flex-row items-center">
                                        <div class="flex-1"></div>
                                        <div class="bg-violet-100 px-3 py-1 mb-1 mx-2 rounded-xl shadow-lg">
                                            <%= messages[i].text %>
                                        </div>
                                        <div class="flex-1"></div>
                                    </div>
                                <% } %>   
                            <% } %> 
                        </div>

                        <div class="bg-violet-300 h-12 py-2 px-3 w-auto shrink">
                            <div class="flex flex-row items-center">
                                    <input type="text" class="py-1 px-3 rounded-full w-full bg-violet-100" placeholder="Type your message" id="inputMessage">
                                    <button class="ml-3" id="send_button">Send</button>
                            </div>
                        </div>
                        
                    </div>
                    <% } else { %>
                        <div class="m-8 grow rounded-2xl shadow-2xl flex flex-col w-full">
                            <div class="flex-1"></div>
                            <div class="text-3xl text-center">Выбери чат</div>
                            <div class="flex-1"></div>
                        </div>
                    <% } %> 
            </div>
        </div>
        </div>